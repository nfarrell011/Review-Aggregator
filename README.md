# Review Aggregator
___

### Overview:  

This project contains an ETL pipeline for restaurant review data. The data is extracted via webscrapers from OpenTable, Yelp, and Google. The raw data is staged in csv files (```/data/raw/```). The data is then cleaned and processed and staged again in csv files (```/data/curated/```). The curated data is then loaded in into a relational database (```/data/database/```).

<img src = "/figs/data_lineage.png" width = 700 height = 400>  

___
### Methodology:
This section provides a brief description of how the program works. Further details on each step are provided in the section ```README.md``` files.
* [Scraper README](scrapers/README.md)
* [Transformer README](data_transformers/README.md)
* [Database README](db_manager/README.md)


This program works in stages:

**Step 1: Extract Yelp Data:**
* Execute the Yelp scraper (```/scarpers/yelp_scraper_driver.py```) setting the variable ```region``` to the desired location, i.e., city, state. 
* This will extract all the restaurant and review data from that region.
* The data extracted will be staged in two ```csv's```:
  * ```/data/raw/yelp_restaurant_data_City_State_Date.csv```
  * ```/data/raw/yelp_review_data_City_State_Date.csv```
    * Where: *City_State* references the region and *date* refereces the date of extraction.
  
**Step 2: Extract OpenTable Data:**
* Execute the OpenTable scraper (```scrapers/opentable_scraper_restaurant_list_driver.py```). The OpenTable scraper will extract a list of restaurants from the raw data ```.csv``` generated by the Yelp scraper.
* The OpenTable scraper will will attempt to scrape the restaurant and review data from each restaurant in the list (*attempt* because not all restuarants use OpenTable).
* The data extracted will be staged in two ```csv's```:
  * ```/data/raw/open_table_restaurant_data_City_State_date.csv```
  * ```/data/raw/open_table_review_data_City_State_date.csv```
* *There is a second OpenTable scraper ```/scrapers/opentable_scraper_region_driver.py``` that will scrape OpenTable by region. This was discovered to be unreliable. The OpenTable region search will not return a comprehensive list of **ALL** the restuarants that use OpenTable in that region.*

**Step 3: Transform Data:**  
Naturally, there is a lack of uniformity among the raw data csv's generated from the scrapers. As a result, each raw data csv has it's on data cleaner/transformer. These scripts can be excuted in any order.

Execute the following scripts:
* ```/data_transformers/transformer_drivers/open_table_res_data_transformer_driver.py```
* ```/data_transformers/transformer_drivers/open_table_review_data_transformer_driver.py```
* ```/data_transformers/transformer_drivers/yelp_res_data_transformer_driver.py```
* ```/data_transformers/transformer_drivers/yelp_review_data_transformer_driver.py```

These scripts will generate the following files:
* ```/data/curated/open_table_restaurant_data_City_State_Date_CURATED.csv```
* ```/data/curated/open_table_review_data_City_State_Date_CURATED.csv```
* ```/data/curated/yelp_restaurant_data_City_State_Date_CURATED.csv```
* ```/data/curated/yelp_review_data_City_State_Date_CURATED.csv```
  
**Step 4: Load Data Into Data Base:**  
The final step is load the curated data into the final database. This is done with the ```RestaurantReviewDb``` class located in this file: ```/db_manager/database_manager_class.py```.
* Example usage can be seen in ```db_manager/database_manager_driver.ipynb``` notebook.
___


### File Structure:
```
review_aggregator/
├── data/
│   ├── curated/
│       ├── open_table_restaurant_data_Portland_ME_2024-07-21_CURATED.csv
│       ├── open_table_review_data_Portland_ME_2024-07-21_CURATED.csv
│       ├── yelp_restaurant_data_Portland_ME_2024-06-29_CURATED.csv
│       └── yelp_review_data_Portland_ME_2024-06-29_CURATED.csv
│   ├── database/
│       └── restaurant_review_database.db
│   ├── raw/
│       ├── open_table_restaurant_data_Portland_ME_2024-07-21.csv
│       ├── open_table_review_data_Portland_ME_2024-07-21.csv
│       ├── yelp_restaurant_data_Portland_ME_2024-06-29.csv
│       └── yelp_review_data_Portland_ME_2024-06-29.csv
├── data_transformers/
│   ├── transformer_classes/ 
│       ├── open_table_res_data_transformer.py
│       ├── open_table_review_data_transformer.py
│       ├── yelp_table_res_data_transformer.py
│       └── yelp_table_res_data_transformer.py
│   ├── transformer_drivers/ 
│       ├── open_table_res_data_transformer_driver.py
│       ├── open_table_review_data_transformer_driver.py
│       ├── yelp_table_res_data_transformer_driver.py
│       └── yelp_table_res_data_transformer_driver.py
│   ├── READme.md
├── db_manager/
│   ├── data_base_driver.ipynb
│   ├── database_manager_class.py
│   └── READme.md
├── scraper/
│   ├──scraper_classes/
│       ├── google_scraper_class.py
│       ├── opentable_scraper_region_class.py
│       ├── opentable_scraper_restaurant_list.py
│       └── yelp_scraper_class.py
│   ├──scraper_drivers/
│       ├── google_scraper_driver.py
│       ├── opentable_scraper_region_driver.py
│       ├── opentable_scraper_restaurant_driver.py
│       └── yelp_scraper_driver.py
│   └── READme.md
└── READme.md

```
